# 地圖與任務系統說明

## 新增功能

### 1. 互動式地圖
- 使用 Leaflet 地圖庫實現互動式地圖
- OpenStreetMap 作為地圖底圖
- 支援縮放、拖曳等標準地圖操作

### 2. GPS 即時定位
- 自動獲取使用者的即時位置
- 顯示位置精確度範圍
- 地圖自動居中到使用者位置
- 持續追蹤位置變化

### 3. 任務系統
- **任務狀態**：
  - 可接受（紫色標記）
  - 進行中（橙色標記）
  - 已完成（綠色標記）

- **任務功能**：
  - 點擊地圖標記查看任務詳情
  - 只能在任務範圍內（預設100米）接受任務
  - 完成任務後獲得力量值和心情值獎勵
  - 任務範圍以虛線圓圈顯示

### 4. 雙模式查看
- **地圖模式**：在地圖上查看所有任務位置
- **列表模式**：以列表形式查看任務，分為：
  - 進行中的任務
  - 可接受的任務
  - 已完成的任務

### 5. 視覺化功能
- 自定義任務標記圖標（根據狀態和類別）
- 用戶位置藍色圓點標記
- 任務範圍圓圈顯示
- 距離計算和顯示
- 動畫效果（標記彈跳、圓圈展開等）

## 技術實現

### 使用的技術
- **react-leaflet**: React 的 Leaflet 綁定
- **leaflet**: 開源地圖庫
- **Geolocation API**: 瀏覽器原生定位 API

### 核心組件
1. `MapView.tsx`: 地圖組件
2. `quest.ts`: 任務類型定義
3. `Travel.tsx`: 整合頁面

### 關鍵功能
- 實時距離計算（使用 Haversine 公式）
- 地理圍欄檢查（判斷用戶是否在任務範圍內）
- 位置追蹤（使用 watchPosition）
- 狀態管理（使用 React Hooks）

## 使用方式

1. **允許定位權限**：首次訪問需要允許瀏覽器獲取位置
2. **查看地圖**：地圖會自動顯示你的位置和附近的任務
3. **選擇任務**：點擊地圖上的標記查看任務詳情
4. **接受任務**：在任務範圍內點擊「接受任務」按鈕
5. **完成任務**：前往任務地點，在範圍內點擊「完成打卡」
6. **獲得獎勵**：完成任務後自動獲得力量值和心情值

## 任務列表

目前包含 8 個台北地區的任務地點：
1. 台北101（景點）
2. 象山步道（景點）
3. 大安森林公園（公園）
4. 陽明山國家公園（景點）
5. 北投溫泉（景點）
6. 天母運動公園（運動場館）
7. 台北小巨蛋（運動場館）
8. 河濱自行車道（運動場館）

## 未來擴展建議

1. **後端整合**：將任務狀態和獎勵同步到後端
2. **更多任務類型**：添加限時任務、連續打卡等
3. **社交功能**：查看其他玩家的位置和進度
4. **成就系統**：完成特定任務組合獲得成就
5. **路線規劃**：提供前往任務地點的路線導航
6. **離線支持**：下載地圖離線使用
7. **自定義任務**：允許用戶創建自己的任務地點

## 注意事項

- 需要 HTTPS 或 localhost 才能使用定位功能
- 首次使用需要授予位置權限
- 定位精確度取決於設備和環境
- 建議在戶外使用以獲得更好的定位精確度
